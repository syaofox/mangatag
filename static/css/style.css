* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }
body { font-family: system-ui, sans-serif; background: #fff; color: #333; display: flex; min-height: 100vh; line-height: 1.5; }
.main-content { flex: 1; min-width: 0; overflow-y: auto; padding: 1rem 2rem; max-width: 100%; }
.log-panel { width: var(--log-panel-width, 320px); min-width: 40px; max-width: 80vw; flex-shrink: 0; height: 100vh; display: flex; flex-direction: column; border-left: 1px solid #ddd; background: #fafafa; position: relative; transition: width 0.2s ease; }
.log-panel.collapsed { width: 40px !important; min-width: 40px; }
.log-panel.collapsed .log-panel-header .section-title,
.log-panel.collapsed .log-panel-body { display: none; }
.log-panel.collapsed .log-panel-toggle { transform: rotate(180deg); margin: 0; padding: 0.5rem; }
.log-panel.collapsed .log-panel-header { justify-content: center; padding: 0.5rem 0; }
.log-panel-resize-handle { position: absolute; left: 0; top: 0; bottom: 0; width: 6px; cursor: col-resize; z-index: 2; }
.log-panel-resize-handle:hover { background: rgba(0,102,204,0.15); }
.log-panel-resize-handle::before { content: ""; position: absolute; left: 2px; top: 50%; transform: translateY(-50%); width: 2px; height: 24px; background: #ccc; border-radius: 1px; opacity: 0; transition: opacity 0.15s; }
.log-panel-resize-handle:hover::before { opacity: 1; }
.log-panel.collapsed .log-panel-resize-handle { cursor: default; pointer-events: none; }
.log-panel-header { display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; margin-top: 1rem; flex-shrink: 0; }
.log-panel .section-title { padding: 0; margin: 0 0.5rem 0 0; }
.log-panel-toggle { background: none; border: none; cursor: pointer; color: #666; font-size: 0.9rem; padding: 0.25rem; margin: -0.25rem -0.25rem -0.25rem 0; border-radius: 4px; }
.log-panel-toggle:hover { color: #0066cc; background: rgba(0,102,204,0.1); }
.log-panel-body { flex: 1; min-height: 0; display: flex; flex-direction: column; overflow: hidden; }
.log-panel #unified-log { flex: 1; overflow-y: auto; min-height: 0; margin: 0 1rem 1rem; }
h1 { font-size: 1.25rem; margin-bottom: 0.5rem; }
.subtitle { color: #666; font-size: 0.9rem; margin-bottom: 1rem; }
label { display: block; margin-top: 0.75rem; margin-bottom: 0.25rem; color: #555; }
input[type="text"], select, textarea { width: 100%; max-width: min(640px, 100%); padding: 0.5rem; background: #fff; border: 1px solid #ccc; border-radius: 4px; color: #333; box-sizing: border-box; }
textarea { min-height: 120px; font-family: ui-monospace, monospace; font-size: 0.875rem; }
#csv-area textarea { min-height: 280px; max-width: none; width: 100%; white-space: pre; overflow-x: auto; }
.csv-table-container { overflow: auto; border: 1px solid #ddd; border-radius: 4px; margin-top: 0.25rem; }
.csv-table { border-collapse: collapse; font-size: 0.85rem; width: max-content; min-width: 100%; table-layout: auto; }
.csv-table th, .csv-table td { border: 1px solid #ddd; padding: 0.25rem 0.4rem; text-align: left; white-space: nowrap; }
.csv-table th { background: #f0f0f0; font-weight: 600; position: sticky; top: 0; }
.csv-table th.csv-th-draggable { cursor: grab; }
.csv-table th.csv-th-draggable:active { cursor: grabbing; }
.csv-table th.csv-th-dragging { opacity: 0.6; }
.csv-table th.csv-th-drop-target { background: #d0e8ff; outline: 2px solid #0066cc; }
.csv-header-menu { display: none; position: fixed; z-index: 1100; background: #fff; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); padding: 0.25rem; min-width: 120px; max-height: calc(100vh - 24px); overflow-x: hidden; overflow-y: auto; }
.csv-header-menu.open { display: flex; flex-direction: column; }
.csv-header-menu button { display: block; width: 100%; padding: 0.4rem 0.75rem; text-align: left; border: none; background: none; cursor: pointer; font-size: 0.9rem; color: #333; border-radius: 2px; }
.csv-header-menu button:hover { background: #e8f0fe; color: #0066cc; }
.csv-header-menu button:disabled { opacity: 0.5; cursor: not-allowed; }
.csv-header-menu-divider { display: block; height: 1px; background: #ddd; margin: 0.25rem 0; }
/* è®©å•å…ƒæ ¼å†…æ–‡æœ¬è¾“å…¥å æ»¡å•å…ƒæ ¼å®½åº¦ï¼Œé¿å…è§†è§‰æˆªæ–­ï¼›è¶…å‡ºæ—¶é€šè¿‡å®¹å™¨æ¨ªå‘æ»šåŠ¨æŸ¥çœ‹ */
.csv-table td input { width: 100%; min-width: 8em; border: none; padding: 0.2rem; background: transparent; font: inherit; box-sizing: border-box; }
.csv-table td input:focus { outline: 1px solid #0066cc; background: #fff; }
.csv-table td input.csv-cell-filename { background: #f5f5f5; cursor: grab; }
.csv-table td input.csv-cell-filename:focus { cursor: grabbing; }
.csv-table td.csv-row-handle { cursor: grab; }
.csv-table td.csv-row-handle:active { cursor: grabbing; }
.csv-table tr.csv-row-dragging { opacity: 0.6; }
.csv-table tr.csv-row-drop-target { background: #e8f4ff; }
button, .btn { display: inline-block; padding: 0.5rem 1rem; background: #0066cc; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; margin-right: 0.5rem; margin-top: 0.5rem; }
button:hover, .btn:hover { background: #0052a3; }
button:disabled { opacity: 0.6; cursor: not-allowed; }
.row { display: flex; gap: 1rem; flex-wrap: wrap; align-items: flex-end; }
.col { flex: 1; min-width: 200px; }
.log { white-space: pre-wrap; font-family: ui-monospace, monospace; font-size: 0.8rem; background: #f5f5f5; padding: 0.75rem; border-radius: 4px; min-height: 80px; border: 1px solid #ddd; }
.accordion { border: 1px solid #ccc; border-radius: 4px; background: #fafafa; }
.accordion summary { padding: 0.5rem 1rem; cursor: pointer; }
.accordion .body { padding: 1rem; border-top: 1px solid #ccc; }
.batch-cols-label { display: inline-block; margin-right: 0.5rem; vertical-align: top; color: #555; }
.batch-cols-checkboxes { display: flex; flex-wrap: wrap; gap: 0.5rem 1.5rem; align-items: center; }
.batch-cols-option { display: inline-flex; align-items: center; gap: 0.25rem; cursor: pointer; white-space: nowrap; }
a.btn, a#export-btn { color: #fff; text-decoration: none; }
.htmx-request .htmx-indicator { display: inline; }
.htmx-indicator { display: none; }
/* è¯·æ±‚è¿›è¡Œä¸­ç¦ç”¨æŒ‰é’®ï¼Œé¿å…é‡å¤æäº¤å¯¼è‡´æ—¥å¿—ä¸æ“ä½œé”™ä½ */
#scan-btn.htmx-request { pointer-events: none; opacity: 0.7; }
#save-form.saving #save-btn { pointer-events: none; opacity: 0.7; }
.path-with-browse { display: flex; gap: 0.5rem; align-items: center; max-width: min(640px, 100%); width: 100%; }
.path-with-browse input { flex: 1; min-width: 0; }
.path-with-browse .btn { flex-shrink: 0; margin-top: 0; }
/* å¸ƒå±€ä½“ç³» */
.section { margin-bottom: 1.25rem; }
.section-title { font-size: 0.9rem; font-weight: 600; color: #444; margin-bottom: 0.5rem; }
.form-row { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; }
.form-row .control-group { display: flex; align-items: center; gap: 0.5rem; }
.form-row .control-group label { margin: 0; display: inline-flex; align-items: center; gap: 0.25rem; }
.control-group { margin-bottom: 0.5rem; }
.control-group label { margin-bottom: 0.25rem; }

/* ç›®å½•é€‰æ‹©ï¼šç½‘æ ¼æ’å¸ƒï¼Œå®½åº¦è‡ªé€‚åº” */
.dir-form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(min(280px, 100%), 1fr)); gap: 1rem 2rem; }
.dir-path-group { grid-column: 1 / -1; }
.dir-list-row { flex: 1; min-width: 0; }
.dir-list-row .dir-list-input { flex: 1; min-width: 12rem; max-width: 100%; }
.dir-edit-group { grid-column: 1 / -1; }
.dir-edit-group input { max-width: min(640px, 100%); }

/* æ‰«æé€‰é¡¹ï¼šæ¨ªå‘æ’å¸ƒï¼Œè‡ªé€‚åº” */
.scan-options-row { flex-wrap: wrap; gap: 1rem; }
.scan-option-item { display: inline-flex; align-items: center; gap: 0.5rem; margin: 0; }
.scan-option-item label { margin: 0; }
.sort-select { max-width: min(180px, 100%); }

/* æ‰¹é‡ç¼–è¾‘è¾“å…¥æ¡†ï¼šå¼¹æ€§å®½åº¦ */
.batch-input { max-width: min(200px, 100%); flex: 1; min-width: 6rem; }
.batch-input-val { max-width: min(240px, 100%); }
.batch-input-small { max-width: min(120px, 100%); flex: 0 1 auto; min-width: 4rem; }
.batch-hint { font-size: 0.85rem; color: #666; margin: 0 0 1rem 0; }
.batch-group { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e8e8e8; }
.batch-group:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
.batch-group-title { font-size: 0.85rem; color: #555; margin-bottom: 0.5rem; }
.save-section { display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; }
.btn-primary { background: #0066cc; font-weight: 500; }
.btn-primary:hover { background: #0052a3; }
#browse-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 1000; align-items: center; justify-content: center; }
#browse-modal.open { display: flex; }
#browse-modal .dialog { background: #fff; border-radius: 8px; padding: 1.25rem; min-width: 360px; max-width: 90vw; max-height: 70vh; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
#browse-modal .dialog h3 { margin: 0 0 0.75rem; font-size: 1rem; }
#browse-modal .current-path { font-size: 0.85rem; color: #555; word-break: break-all; margin-bottom: 0.75rem; padding: 0.5rem; background: #f5f5f5; border-radius: 4px; }
#browse-modal .folder-list { overflow-y: auto; max-height: 280px; border: 1px solid #ddd; border-radius: 4px; padding: 0.25rem; }
#browse-modal .folder-item { display: block; width: 100%; padding: 0.5rem 0.75rem; text-align: left; border: none; background: none; cursor: pointer; border-radius: 4px; font-size: 0.95rem; color: #333; }
#browse-modal .folder-item:hover { background: #e8f0fe; }
#browse-modal .folder-item::before { content: "ğŸ“ "; }
#browse-modal .folder-item.parent::before { content: "â¬† "; }
#browse-modal .actions { margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: flex-end; }

.csv-find-replace-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 1100; align-items: center; justify-content: center; }
.csv-find-replace-modal.open { display: flex; }
.csv-find-replace-modal .csv-fr-dialog { background: #fff; border-radius: 8px; padding: 1.25rem; min-width: 360px; max-width: 90vw; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
.csv-find-replace-modal .csv-fr-dialog h3 { margin: 0 0 1rem; font-size: 1rem; }
.csv-find-replace-modal .csv-fr-form { display: flex; flex-direction: column; gap: 0.75rem; }
.csv-find-replace-modal .csv-fr-form label { font-size: 0.9rem; color: #555; }
.csv-find-replace-modal .csv-fr-form input { padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.95rem; }
.csv-find-replace-modal .csv-fr-actions { margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: flex-end; }
.csv-fr-regex-help { display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; margin-left: 0.35rem; font-size: 0.8rem; font-weight: 600; color: #0066cc; background: #e8f0fe; border-radius: 50%; cursor: help; line-height: 1; }
.csv-fr-regex-help:hover { background: #d0e4ff; }
.csv-fr-regex-label { display: flex; align-items: center; gap: 0.4rem; font-weight: normal; cursor: pointer; }
.csv-fr-regex-tip { position: fixed; z-index: 1200; background: #fff; border: 1px solid #ccc; border-radius: 6px; padding: 0.75rem 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); font-size: 0.85rem; max-width: 280px; }
.csv-fr-regex-tip strong { display: block; margin-bottom: 0.5rem; }
.csv-fr-regex-tip ul { margin: 0; padding-left: 1.2rem; }
.csv-fr-regex-tip li { margin: 0.2rem 0; }
.csv-fr-regex-tip code { background: #f0f0f0; padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.9em; }

/* çª„å±è‡ªé€‚åº” */
@media (max-width: 768px) {
  .main-content { padding: 1rem; }
  .dir-form-grid { grid-template-columns: 1fr; gap: 1rem; }
  .dir-list-row { flex-direction: column; align-items: stretch; }
  .dir-list-row .dir-list-input { min-width: 0; }
  .scan-options-row { flex-direction: column; align-items: flex-start; }
  .form-row { flex-direction: column; align-items: stretch; }
  .form-row .batch-input, .form-row .batch-input-small { max-width: 100%; }
}
